---
doc_type: weread-highlights-reviews
bookId: "907755"
author: 户根勤
cover: https://cdn.weread.qq.com/weread/cover/15/YueWen_907755/t7_YueWen_907755.jpg
reviewCount: 0
noteCount: 66
isbn: 9787115441249
category: 计算机-计算机综合
lastReadDate: 2021-04-18
---
# 元数据
> [!abstract] 网络是怎样连接的
> - ![ 网络是怎样连接的|200](https://cdn.weread.qq.com/weread/cover/15/YueWen_907755/t7_YueWen_907755.jpg)
> - 书名： 网络是怎样连接的
> - 作者： 户根勤
> - 简介： 本书以探索之旅的形式，从在浏览器中输入网址开始，一路追踪了到显示出网页内容为止的整个过程，以图配文，讲解了网络的全貌，并重点介绍了实际的网络设备和软件是如何工作的。目的是帮助读者理解网络的本质意义，理解实际的设备和软件，进而熟练运用网络技术。同时，专设了“网络术语其实很简单”专栏，以对话的形式介绍了一些网络术语的词源，颇为生动有趣。本书图文并茂，通俗易懂，非常适合计算机、网络爱好者及相关从业人员阅读。
> - 出版时间 2017-01-01 00:00:00
> - ISBN： 9787115441249
> - 分类： 计算机-计算机综合
> - 出版社： 人民邮电出版社

# 高亮划线

## 1.1 生成HTTP请求消息


- 📌 当没有路径名时，就代表访问根目录下事先设置的默认文件[插图]，也就是/index. html或者/default.htm这些文件，这样就不会发生混乱了。 
    - ⏱ 2021-01-29 19:56:20 

- 📌 “对什么”的部分称为URI 
    - ⏱ 2020-08-22 10:18:54 

- 📌 ，URI的内容是一个存放网页数据的文件名或者是一个CGI程序[插图]的文件名 
    - ⏱ 2021-01-29 20:15:41 

- 📌 POST。我们在表单[插图]中填写数据并将其发送给Web服务器时就会使用这个方法。 
    - ⏱ 2021-01-29 20:15:40 

- 📌 了PUT和DELETE方法，就能够从客户端修改或者删除Web服务器上的文件。 
    - ⏱ 2021-01-29 20:16:22 

- 📌 在响应消息中，第一行的内容为状态码和响应短语，用来表示请求的执行结果是成功还是出错。 
    - ⏱ 2021-01-29 20:26:42 

- 📌 由于每条请求消息中只能写1个URI，所以每次只能获取1个文件，如果需要获取多个文件，必须对每个文件单独发送1条请求。 
    - ⏱ 2020-09-13 11:41:14 
## 1.2 向DNS服务器查询Web服务器的IP地址


- 📌 在委托操作系统发送消息时，必须要提供的不是通信对象的域名，而是它的IP地址 
    - ⏱ 2020-09-13 11:41:18 

- 📌 根据域名查询IP地址 
    - ⏱ 2020-09-13 11:41:16 

- 📌 子网掩码为1的部分表示网络号，子网掩码为0的部分表示主机号。 
    - ⏱ 2020-09-13 11:41:17 

- 📌 子网掩码表示网络号与主机号之间的边界 
    - ⏱ 2020-09-13 11:41:17 

- 📌 主机号部分全部为0代表整个子网 
    - ⏱ 2020-09-13 11:41:15 

- 📌 主机号部分全部为1代表向子网上所有设备发送包，即广播 
    - ⏱ 2020-09-13 11:41:14 

- 📌 发送消息这个操作并不是由解析器自身来执行，而是要委托给操作系统内部的协议栈[插图]来执行。 
    - ⏱ 2021-01-31 15:36:38 
## 1.3 全世界DNS服务器的大接力


- 📌 记录类型为MX时，DNS服务器会在记录中保存两种信息，分别是邮件服务器的域名和优先级[插图]。此外，MX记录的返回消息还包括邮件服务器mail.glasscom.com的IP地址 
    - ⏱ 2021-01-31 15:45:03 
## 1.4 委托协议栈发送消息


- 📌 将描述符理解成给某个套接字分配的编号。 
    - ⏱ 2021-01-31 16:20:26 

- 📌 这里的要点是当调用connect时，需要指定描述符、服务器IP地址和端口号这3个参数 
    - ⏱ 2021-01-31 16:21:53 

- 📌 连接操作的对象是某个具体的套接字，因此必须要识别到具体的套接字才行，而仅凭IP地址是无法做到这一点的。 
    - ⏱ 2021-01-31 16:23:55 

- 📌 当同时指定IP地址和端口号时，就可以明确识别出某台具体的计算机上的某个具体的套接字 
    - ⏱ 2021-01-31 16:24:11 

- 📌 如果说描述符是用来在一台计算机内部识别套接字的机制，那么端口号就是用来让通信的另一方能够识别出套接字的机制[插图]。 
    - ⏱ 2021-01-31 16:25:22 

- 📌 客户端和服务器之间用来识别对方套接字的机制 
    - ⏱ 2021-01-31 16:27:27 

- 📌 调用read时需要指定用于存放接收到的响应消息的内存地址，这一内存地址称为接收缓冲区 
    - ⏱ 2021-01-31 16:30:19 

- 📌 Web使用的HTTP协议规定，当Web服务器发送完响应消息之后，应该主动执行断开操作[插图]，因此Web服务器会首先调用close来断开连接。断开操作传达到客户端之后，客户端的套接字也会进入断开阶段。接下来，当浏览器调用read执行接收数据操作时，read会告知浏览器收发数据操作已结束，连接已经断开。浏览器得知后，也会调用close进入断开阶段。 
    - ⏱ 2021-01-31 16:32:59 
## 2.1 创建套接字


- 📌 在协议栈内部有一块用于存放控制信息的内存空间，这里记录了用于控制通信操作的控制信息，例如通信对象的IP地址、端口号、通信操作的进行状态等。本来套接字就只是一个概念而已，并不存在实体，如果一定要赋予它一个实体，我们可以说这些控制信息就是套接字的实体，或者说存放控制信息的内存空间就是套接字的实体。 
    - ⏱ 2021-01-31 22:54:09 

- 📌 协议栈是根据套接字中记录的控制信息来工作的。 
    - ⏱ 2021-01-31 22:55:26 

- 📌 描述符相当于用来区分协议栈中的多个套接字的号码牌 
    - ⏱ 2021-01-31 23:29:32 
## 2.2 连接服务器


- 📌 我们需要把服务器的IP地址和端口号等信息告知协议栈，这是连接操作的目的之一。 
    - ⏱ 2021-01-31 23:32:43 

- 📌 客户端和服务器相互联络时交换的控制信息。 
    - ⏱ 2021-01-31 23:43:27 
## 2.3 收发数据


- 📌 MTU是包含头部的总长度，因此需要从MTU减去头部的长度，然后得到的长度就是一个网络包中所能容纳的最大数据长 
    - ⏱ 2021-02-01 12:14:01 

- 📌 度，这一长度叫作MSS[插图]。当从应用程序收到的数据长度超过或者接近MSS时再发送出去，就可以避免发送大量小包的问题了 
    - ⏱ 2021-02-01 12:14:24 
## 2.4 从服务器断开并删除套接字


- 📌 这一判断是应用程序作出的，协议栈在设计上允许任何一方先发起断开过程。 
    - ⏱ 2021-02-01 15:37:37 
## 2.5 IP与以太网的包收发操作


- 📌 IP头部中包含IP协议规定的、根据IP地址将包发往目的地所需的控制信息；MAC头部包含通过以太网的局域网将包传输至最近的路由器所需的控制信息 
    - ⏱ 2021-02-01 16:11:46 
## 3.3 路由器的包转发操作


- 📌 因为路由器是基于IP设计的，而交换机是基于以太网设计的[插图]。 
    - ⏱ 2021-02-03 18:39:50 

- 📌 大家可以将路由器的转发模块想象成IP模块，将端口模块想象成网卡。 
    - ⏱ 2021-02-03 18:41:21 

- 📌 首先会通过端口将发过来的包接收进来， 
    - ⏱ 2021-02-03 18:43:47 

- 📌 。接下来，转发模块会根据接收到的包的IP头部中记录的接收方IP地址，在路由表中进行查询，以此判断转发目标。 
    - ⏱ 2021-02-03 18:44:06 

- 📌 然后，转发模块将包转移到转发目标对应的端口，端口再按照硬件的规则将包发送出去，也就是转发模块委托端口模块将包发送出去的意思。 
    - ⏱ 2021-02-03 18:44:23 

- 📌 这一点和交换机是不同的，交换机只是将进来的包转发出去而已，它自己并不会成为发送方或者接收方 
    - ⏱ 2021-02-03 18:46:03 

- 📌 信号到达网线接口部分，其中的PHY（MAU）模块和MAC模块将信号转换为数字信息，然后通过包末尾的FCS进行错误校验，如果没问题则检查MAC头部中的接收方MAC地址，看看是不是发给自己的包，如果是就放到接收缓冲区中，否则就丢弃这个包。 
    - ⏱ 2021-02-04 10:11:32 
## 3.4 路由器的附加功能


- 📌 地址转换和包过滤。 
    - ⏱ 2021-02-13 13:21:59 

- 📌 网地址重复无关紧要，只要每个公司的网络是相互独立的，就不会出现问题 
    - ⏱ 2021-02-13 13:21:59 

- 📌 地址转换的基本原理是在转发网络包时对IP头部中的IP地址和端口号[插图]进行改写。 
    - ⏱ 2021-02-13 13:23:15 

- 📌 包过滤就是在对包进行转发时，根据MAC头部、IP头部、TCP头部的内容[插图]，按照事先设置好的规则决定是转发这个包，还是丢弃这个包。我们通常说的防火墙设备或软件，大多数都是利用这一机制来防止非法入侵的[插图]。 
    - ⏱ 2021-02-13 13:35:08 
## 6.1 服务器概览


- 📌 因此一般的做法是，每有一个客户端连接进来，就启动一个新的服务器程序，确保服务器程序和客户端是一对一的状态。 
    - ⏱ 2021-04-18 19:36:43 

- 📌 发起连接的一方是客户端，等待连接的一方是服务器。 
    - ⏱ 2021-03-04 15:49:58 

- 📌 这样每次为新的连接创建新的套接字就是这一步操作的一个关键点。如果不创建新副本，而是直接让客户端连接到等待连接的套接字上，那么就没有套接字在等待连接了，这时如果有其他客户端发起连接就会遇到问题。为了避免出现这样的情况，协议栈采用了这种创建套接字的新副本，并让客户端连接到这个新副本上的方法。 
    - ⏱ 2021-04-12 23:42:22 

- 📌 新创建的套接字副本必须和原来的等待连接的套接字具有相同的端口号。 
    - ⏱ 2021-04-12 23:43:27 

- 📌 即要确定某个套接字时，不仅使用服务器端套接字对应的端口号，还同时使用客户端的端口号再加上IP地址 
    - ⏱ 2021-04-12 23:44:28 

- 📌 服务器上可能存在多个端口号相同的套接字，但客户端的套接字都是对应不同端口号的，因此我们可以通过客户端的端口号来确定服务器上的某个套接字。 
    - ⏱ 2021-04-12 23:46:35 
## 6.2 服务器的接收操作


- 📌 以太网的基本工作方式是将数据广播到整个网络上，只有指定的接收者才接收数据 
    - ⏱ 2021-04-18 19:38:17 

- 📌 接收信号并还原成数字信息的操作就完成了，还原后的数字信息被保存在网卡内部的缓冲区中。上面这些操作都是由网卡的MAC模块 
    - ⏱ 2021-04-18 19:38:37 

- 📌 网卡需要通过中断将网络包到达的事件通知给CPU 
    - ⏱ 2021-04-18 19:39:05 

- 📌 网卡驱动会根据MAC头部判断协议类型，并将包交给相应的协议栈。 
    - ⏱ 2021-04-18 19:39:35 

- 📌 如果是分片的包，则将包暂时存放在内存中，等所有分片全部到达之后将分片组装起来还原成原始包；如果没有分片，则直接保留接收时的样子，不需要进行重组。到这里，我们就完成了包的接收。 
    - ⏱ 2021-04-18 19:41:44 

- 📌 06（十六进制），则将包转交给TCP模块；如果是11（十六进制），则转交给UDP模块 
    - ⏱ 2021-04-18 19:41:55 

- 📌 （1）判断是不是发给自己的；（2）判断网络包是否经过分片；（3）将包转交给TCP模块或UDP模块 
    - ⏱ 2021-04-18 19:42:04 

- 📌 不过在此之前，需要先检查包的接收方端口号，并确认在该端口上有没有与接收方端口号相同且正在处于等待连接状态的套接字。如果指定端口号没有等待连接的套接字，则向客户端返回错误通知的包 
    - ⏱ 2021-04-18 19:43:11 

- 📌 然后生成代表接收确认的ACK号，用于从服务器向客户端发送数据的序号初始值，表示接收缓冲区剩余容量的窗口大小，并用这些信息生成TCP头部，委托IP模块发送给客户端[插图] 
    - ⏱ 2021-04-13 15:40:53 

- 📌 因此仅根据接收方端口号无法找到特定的套接字。这时我们需要根据IP头部中的发送方IP地址和接收方IP地址，以及TCP头部中的接收方端口号和发送方端口号共4种信息，找到上述4种信息全部匹配的套接字[插图]。 
    - ⏱ 2021-04-13 15:37:47 
## 6.3 Web服务器程序解释请求消息并作出响应


- 📌 URI中写的就是在这个虚拟目录结构下的路径名 
    - ⏱ 2021-04-18 19:46:38 

- 📌 首先是根据客户端IP地址设置的规则，这个情况很简单，在调用accept接受连接时，就已经知道客户端的IP地址了，只要检查其是否允许访问就可以了。 
    - ⏱ 2021-04-18 19:59:08 

- 📌 一般我们使用DNS服务器都是根据域名查询IP地址，其实根据IP地址反查域名也可以使用DNS服务器 
    - ⏱ 2021-04-18 19:59:23 

- 📌 这是因为有一种在DNS服务器上注册假域名的攻击方式，因此我们需要进行双重检查，如果两者一致则检查相应的访问控制规则，判断是否允许访问 
    - ⏱ 2021-04-18 20:02:26 

- 📌 但我们并不需要直接告知客户端的IP地址等信息，而是只需要给出表示通信使用的套接字的描述符就可以了 
    - ⏱ 2021-04-18 20:10:20 
## 6.4 浏览器接收响应消息并显示内容


- 📌 响应消息开头的Content-Type头部字段的值来进行判断 
    - ⏱ 2021-04-18 20:13:36 

- 📌 还需要检查Content-Encoding头部字段。如果消息中存放的内容是通过压缩或编码技术对原始数据进行转换得到的，那么Content-Encoding的值就表示具体的转换方式，通过这个字段的值，我们可以知道如何将消息中经过转换的数据还原成原始数据 
    - ⏱ 2021-04-18 20:15:35 
# 读书笔记

# 本书评论
